---
const slides = [
  {
    title: "Disciplina",
    content: {
      paragrapgh:
        "En Comando 99 esperamos que cada miembro sea responsable en sus roles de manera ordenada.",
      subtitle: "Respeto - Trabajo en equipo - Eficacia operativa",
      redirect: "Mas informacion",
      thumbnail: "./images/rangos/red_beret_salute.webp",
      altText: "Soldier with red beret looking proudly to the sky",
    },
  },
  {
    title: "Actividades",
    content: {
      paragrapgh:
        "Tenemos actividades todos los dias, desde entrenamientos y cursos hasta patrullas y misiones con experiencias reales.",
      subtitle: "Entrenamientos - Cursos - Patrullas - Misiones",
      redirect: "Mas informacion",
      thumbnail: "./images/rangos/simple_Hat.webp",
      altText: "Soldier with army hat looking proudly to the sky",
    },
  },
  {
    title: "Rangos",
    content: {
      paragrapgh:
        "Operamos en una herarquia de rangos y como tal se debe respetar la cadena de mando.",
      subtitle: "Ascensos - Merito - Escalafon",
      redirect: "Mas informacion",
      thumbnail: "./images/rangos/modular_helmet.webp",
      altText: "Soldier with modular helmet looking proudly to the sky",
    },
  },
];
---

<section class="showcase carousel-container" id="showcase">
  <div class="carousel">
    <div class="carousel-track">
      {
        slides.map((slide, index) => (
          <div class="carousel-slide" data-slide={index}>
            <div class="slide-content hud-border">
              <div class="content-text">
                <h2>{slide.title}</h2>
                <h3>{slide.content.subtitle}</h3>
                <p>{slide.content.paragrapgh}</p>
                <button>{slide.content.redirect}</button>
              </div>
              <img src={slide.content.thumbnail} alt={slide.content.altText} />
            </div>
          </div>
        ))
      }
    </div>
  </div>
  <button class="carousel-btn prev" aria-label="Previous slide">‹</button>
  <button class="carousel-btn next" aria-label="Next slide">›</button>

  <!-- Pagination Dots -->
  <div class="carousel-pagination">
    {
      slides.map((_, index) => (
        <button
          class="pagination-dot"
          data-slide={index}
          aria-label={`Go to slide ${index + 1}`}
        />
      ))
    }
  </div>
</section>

<style>
  .showcase {
    padding-bottom: 1em;
    padding-top: 1em;
    background: black;
  }
  .carousel-container {
    position: relative;
    width: 100%;
    margin: 0 auto;
    overflow: auto;
  }

  .carousel {
    position: relative;
    width: 100%;
    overflow: hidden;
  }

  .carousel-track {
    display: flex;
    transition: transform 0.5s ease-in-out;
  }
  .carousel-slide {
    max-width: 100vw;
    width: 100%;
    height: 55vh;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color 0.3s;
  }

  .slide-content {
    color: white;
    padding: 8vw;
  }

  .carousel-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(0, 0, 0, 0.5);
    color: white;
    border: none;
    font-size: 4rem;
    padding: 1rem;
    cursor: pointer;
    z-index: 10;
    transition: background 0.2s;
  }

  .carousel-btn:hover {
    background: rgba(128, 7, 7, 0.5);
  }

  .carousel-btn.prev {
    left: 10px;
  }

  .carousel-btn.next {
    right: 10px;
  }

  .carousel-pagination {
    display: flex;
    justify-content: center;
    gap: 1vw;
    margin-top: 20px;
  }

  .pagination-dot {
    width: 24px;
    height: 12px;
    border-radius: 25px;
    border: 2px solid #5f0909;
    background: transparent;
    cursor: pointer;
    transition: background 0.3s;
  }

  .pagination-dot.active {
    background: #5f0909;
  }

  .pagination-dot:hover {
    background: #c90303;
  }

  .slide-content {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    align-items: center;
    width: 100%;
    background: black;
    margin: 1px;

    .content-text {
      margin-left: 1rem;
      margin-top: 1em;

      h2 {
        text-transform: uppercase;
        font-size: 4.5em;
        line-height: 1;
      }

      h3 {
        font-weight: 300;
        color: #cececec4;
        font-family: "Stick No Bills";
        letter-spacing: 0.5px;
        margin-bottom: 1em;
      }

      p {
        font-size: 1.7vw;
        max-width: 40ch;
      }

      button {
        border-color: transparent;
        background: hsla(0, 99%, 49%, 0.63);
        text-shadow: 0 0 5px rgb(0, 0, 0);
        color: white;
        padding: 0.5em 2em;
        font-size: 1em;
        font-weight: 900;
        text-transform: uppercase;
        font-family: inherit;
        letter-spacing: 1px;
        cursor: pointer;
        margin-top: 1em;
        width: 80%;
        border-width: 1px;
        transition: 0.2s;

        &:hover {
          background: rgba(160, 1, 1, 0.747);
          border: 1px solid red;
        }
      }
    }

    img {
      object-fit: cover;
      height: 25vw;
    }
  }
  @media (max-width: 1100px) {
    .carousel-track {
      height: 500px;
    }
    .carousel-slide {
      display: block;
      width: 100%;
    }
    .slide-content p,
    .slide-content h3 {
      font-size: 2rem;
      max-width: none;
    }
    .slide-content img {
      display: none;
      position: absolute;
    }
    .slide-content button {
      font-size: 2rem;
      width: 100%;
    }
    .carousel-btn:hover {
      background: none;
      color: #c90303;
    }
  }
</style>

<script>
  class Carousel {
    container: Element;
    track: Element | null;
    slides: NodeListOf<Element>;
    prevBtn: Element | null;
    nextBtn: Element | null;
    dots: NodeListOf<Element>;
    currentIndex: number;
    autoPlayId: number | null;

    constructor(container: Element) {
      this.container = container;
      this.track = container.querySelector(".carousel-track");
      this.slides = container.querySelectorAll(".carousel-slide");
      this.prevBtn = container.querySelector(".prev");
      this.nextBtn = container.querySelector(".next");
      this.dots = container.querySelectorAll(".pagination-dot");
      this.currentIndex = 0;
      this.autoPlayId = null;
      this.init();
    }

    init() {
      this.updatePagination();

      if (this.prevBtn) {
        this.prevBtn.addEventListener("click", () => {
          this.stopAutoPlay();
          this.goToPrevious();
        });
      }

      if (this.nextBtn) {
        this.nextBtn.addEventListener("click", () => {
          this.stopAutoPlay();
          this.goToNext();
        });
      }

      this.dots.forEach((dot, index) => {
        dot.addEventListener("click", () => {
          this.stopAutoPlay();
          this.goToSlide(index);
        });
      });

      const AUTO_PLAY_INTERVAL_MS = 12000;
      this.startAutoPlay(AUTO_PLAY_INTERVAL_MS);
    }

    goToSlide(index: number) {
      this.currentIndex = index;
      const offset = -100 * index;
      if (this.track instanceof HTMLElement) {
        this.track.style.transform = `translateX(${offset}%)`;
      }
      this.updatePagination();
    }

    goToNext() {
      this.currentIndex = (this.currentIndex + 1) % this.slides.length;
      this.goToSlide(this.currentIndex);
    }

    goToPrevious() {
      this.currentIndex =
        (this.currentIndex - 1 + this.slides.length) % this.slides.length;
      this.goToSlide(this.currentIndex);
    }

    updatePagination() {
      this.dots.forEach((dot, index) => {
        dot.classList.toggle("active", index === this.currentIndex);
      });
    }

    startAutoPlay(interval: number) {
      if (this.autoPlayId) clearInterval(this.autoPlayId);
      this.autoPlayId = window.setInterval(() => this.goToNext(), interval);
    }

    stopAutoPlay() {
      if (this.autoPlayId) {
        clearInterval(this.autoPlayId);
        this.autoPlayId = null;
      }
    }
  }

  // Initialize carousel
  document.addEventListener("DOMContentLoaded", () => {
    const carouselContainer = document.querySelector(".carousel-container");
    if (carouselContainer) {
      new Carousel(carouselContainer);
    }
  });
</script>
